<!DOCTYPE html>
<html lang="en">
<head>
  <title>HDFC Bank Statement</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://momentjs.com/downloads/moment.min.js"></script>
  <script src="http://danml.com/js/download.js"></script>
</head>
<body>

<div style="margin-right:30px; margin-left:30px;">
  <h2>HDFC Bank Statement</h2>
  <div style="border: 1px solid #dbdbdb; border-radius: 5px; width:fit-content; background-color:rgb(245, 245, 245); font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif;">
    <p style="margin-left:10px; margin-right:10px; margin-top:8px"><b>Average Monthly Spend</b> ₹{{AVG_MONTHLY_SPEND}}</p>
    <p style="margin-left:10px; margin-right:10px; margin-top:8px"><b>Average Monthly Earning</b> ₹{{AVG_MONTHLY_EARN}}</p>
    <p style="margin-left:10px; margin-right:10px; margin-top:8px"><b>Debit in provided period</b> ₹{{TOTAL_DEBIT}}</p>
    <p style="margin-left:10px; margin-right:10px; margin-top:8px"><b>Credit in provided period</b> ₹{{TOTAL_CREDIT}}</p>
    <p style="margin-left:10px; margin-right:10px; margin-top:8px"><b>Closing Balance</b> ₹{{TOTAL_BALANCE}}</p>
  </div>
</div>
<br>
<div style="margin-right:30px; margin-left:30px">

  <link href="https://unpkg.com/tabulator-tables@4.1.4/dist/css/bootstrap/tabulator_bootstrap.min.css" rel="stylesheet">
  <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.1.4/dist/js/tabulator.min.js"></script>
  <div id="printMe" class="col-md-10 col-md-offset-10"><button onclick='download(raw.documentElement.outerHTML, "expense.html", "text/html")'>Download Updated Statement</button></div><br><br>
  <div id="example-table" style="border: 1px solid #dbdbdb; border-radius: 5px"></div>

  {% block javascriptscript %}
  <script>

    var data = {{ results|safe }}

    var tableColumns = [
        {
          title: "Merchant",
          field: "Merchant",
          headerFilter: "select",
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        },
        {
          title: "Type",
          field: "Type",
          headerFilter: "select",
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        },
        {
          title: "Mode",
          field: "Mode",
          headerFilter: "select",
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        },
        {
        title: "Amount",
          field: "Amount",
          bottomCalc: "sum",
          bottomCalcFormatter: "money",
          bottomCalcFormatterParams: {
            symbol: "₹ ",
            precision: true
          },
          headerFilter: "number",
          headerFilterFunc: "=",
          headerFilterPlaceholder: "filter",
          width: 150
        },
        {
          title: "Month",
          field: "Month",
          headerFilter: "select",
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        },
        {
          title: "Year",
          field: "Year",
          headerFilter: "select",
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        },
        {
          title: "Remark",
          field: "Remark",
          headerFilter: "select",
          editor:"input",
          editable:true,
          cellDblClick:function(e, cell){
            cell.edit(true);
          },
          headerFilterParams: {
            values: true
          },
          headerFilterPlaceholder: "filter",
          width: 250
        }
      ];

    var table = new Tabulator("#example-table", {
      height: "850px",
      width: "1950px",
      layout: "fitDataStretch",
      movableColumns: true,
      selectable: true,
      columns: tableColumns,
      data: data,
      reactiveData:true,
      cellEdited:function(cell){
         console.log("Cell Edited - Generating new HTML")
         raw = document
         raw.getElementsByTagName('script')[5].text = raw.getElementsByTagName('script')[5].text.replace(/data = \[.*\]/g,'data = ' + JSON.stringify(data))
      },
    });

  </script>
  {% endblock %}

<h>
</div>

</body>
</html>